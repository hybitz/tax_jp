<div class="container">
  <%= form_with model: @finder, url: {action: 'index'}, method: 'get', class: 'form form-vertical', local: true do |f| %>
    <div class="row">
      <div class="col-sm-3 form-group">
        <div class="input-group date" id="datetimepicker4" data-target-input="nearest">
          <label for="datetimepicker1" class="pt-2 pr-2">年月日:</label>
          <%= f.text_field :from, class: 'form-control datetimepicker-input', data: {target: '#datetimepicker4'} %>
          <div class="input-group-append" data-target="#datetimepicker4" data-toggle="datetimepicker">
              <div class="input-group-text"><i class="fa fa-calendar"></i></div>
          </div>
        </div>
      </div>
      <div class="col">
        <%= f.submit '表示', class: 'btn btn-sm btn-default mt-1' %>
      </div>
    </div>
    <script>
          $(function () {
            $('#datetimepicker4').datetimepicker({
              format: 'YYYY-MM-DD',
              locale: 'ja',
              buttons: {
                showClose: true
              }
          });
        });
    </script>
  <% end %>
</div>
<div class="pl-4 pr-4">
  <table class="table table-striped table-bordered table-hover table-sm">
    <thead class="thead-light">
      <tr>
        <th rowspan="5" class="align-middle text-center">賞与の金額に乗ずべき率（％）</th>
        <th colspan="16" class="align-middle text-center">甲</th>
        <th rowspan="3" colspan="2" class="align-middle text-center">乙</th>
      </tr>
      <tr>
        <th colspan="16" class="align-middle text-center">扶養親族等の数</th>
      </tr>
      <tr>
        <% 8.times do |i| %>
          <th colspan="2" class="align-middle text-center"><%= i + 1 %> 人<%= '以上' if i == 7 %></th>
        <% end %>
      </tr>
      <tr>
        <th colspan="18" class="align-middle text-center">前月の社会保険料等控除後の給与等の金額</th>
      </tr>
      <tr>
        <% 9.times do |i| %>
          <th class="align-middle text-center">以上</th>
          <th class="align-middle text-center">未満</th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% @withheld_taxes.each do |wt| %>
        <tr>
          <td class="text-center"><%= wt.tax_ratio_percent %></td>
          <% 8.times do |i| %>
            <%
            from = wt.__send__("dependent_#{i}_salary_from")
            to = wt.__send__("dependent_#{i}_salary_to")
            infinite = to == 2147483647 
            %>
            <td class="text-right"><%= from == 2147483647 ? '-' : from.to_s(:delimited) %></td>
            <td class="<%= infinite ? 'text-center' : 'text-right' %>"><%= infinite ? '-' : to.to_s(:delimited) %></td>
          <% end %>
            <%
            from = wt.sub_salary_from
            to = wt.sub_salary_to
            infinite = to == 2147483647 
            %>
          <td class="text-right"><%= from.to_s(:delimited) unless from == 0 && to == 0 %></td>
          <td class="<%= infinite ? 'text-center' : 'text-right' %>"><%= infinite ? '-' : to.to_s(:delimited) unless from == 0 && to == 0 %></td>
        </tr>
      <% end %>
    </tbody>  
  </table>
</div>